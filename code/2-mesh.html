<html>
  <head>
    <title> Simple Framebuffer </title>
    <script src="./js/simple-framebuffer.js"></script>
    <script src="./js/bresenham.js"></script>
    <script src="./js/model.js"></script>
    <style>
      body,html { background-color: #000; }
      #viewport-container canvas { background-color: #fff; }
    </style>
  </head>
  <body>
    <div id="viewport-container"> </div>
      <canvas id="viewport">
      </canvas>
    <script>
      var kWidth = 512;
      var kHeight = 512;

      var bitmap = new SimpleFramebuffer( kWidth, kHeight, document.getElementById('viewport'));    
      var model = new Model();

      bitmap.clear();
      bitmap.flush();
      var r = new XMLHttpRequest();
      r.open("GET", "assets/head/head.obj", true);
      r.onreadystatechange = function () {
        if (r.readyState == 4 && r.status < 400) {
          console.log('Got model!');
          model.loadFromOBJString(r.responseText);
          var triBuffer = model.toTriArray();
          bitmap.clear();
          for (var i = 0; i < triBuffer.length/3; i++ ){
            var ax = (triBuffer[9*i + 0]+1) * kWidth/2;
            var ay = (triBuffer[9*i + 1]+1) * kHeight/2;
            var bx = (triBuffer[9*i + 3]+1)* kWidth/2;
            var by = (triBuffer[9*i + 4]+1)* kHeight/2;
            var cx = (triBuffer[9*i + 6]+1) * kWidth/2;
            var cy = (triBuffer[9*i + 7]+1) * kHeight/2;
            bresenhamLine(  bitmap,  ax, ay ,  bx, by , 0,255,0,255  );
            bresenhamLine(  bitmap,  bx, by ,  cx, cy , 0,255,0,255  );
            bresenhamLine(  bitmap,  cx, cy ,  ax, ay , 0,255,0,255  );
          }
          bitmap.flush();
        }
      };
      r.send();
    </script>
  </body>
</html>